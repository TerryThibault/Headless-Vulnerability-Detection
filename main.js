const puppeteer = require('puppeteer');

async function run() {
	const browser = await puppeteer.launch(
		{
			headless: false
		});
	const page = await browser.newPage();
	await crawl(page)
}

run();

async function crawl(page) {
	await page.goto('https://wordpress.com');
	var links = await page.evaluate(() => {
        return Array.from(document.querySelectorAll('a')).map(
          link => link.href
    	);
	});
	var uniq_links = new Set(links)
	var not_visited_links = Array.from(uniq_links)
	console.log(not_visited_links)
	while (not_visited_links.length > 0) {
		const curr_link = not_visited_links.shift()
		if (curr_link.charAt(0) != 'h') {
			console.log("skipping " + curr_link)
			continue
		} 
		console.log('visiting ' + curr_link)
		await page.goto(curr_link)
		var links = await page.evaluate(() => {
        	return Array.from(document.querySelectorAll('a')).map(
        		link => link.href
    		);
		});
		links = Array.from(new Set(links))

		links.forEach(function(element) {
			if (!uniq_links.has(element)) {
				uniq_links.add(element);
				not_visited_links.push(element)
				console.log("adding " + element)
			}
		});
	}
	console.log(uniq_links);
}